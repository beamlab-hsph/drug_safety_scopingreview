Article

Disproportionality methods
for pharmacovigilance
in longitudinal observational
databases

Statistical Methods in Medical Research
22(1) 39–56
! The Author(s) 2011
Reprints and permissions:
sagepub.co.uk/journalsPermissions.nav
DOI: 10.1177/0962280211403602
smm.sagepub.com

Ivan Zorych,1 David Madigan,1 Patrick Ryan2
and Andrew Bate3

Abstract
Data mining disproportionality methods (PRR, ROR, EBGM, IC, etc.) are commonly used to identify drug
safety signals in spontaneous report system (SRS) databases. Newer data sources such as longitudinal
observational databases (LOD) provide time-stamped patient-level information and overcome some of
the SRS limitations such as an absence of the denominator, total number of patients who consume a drug,
and limited temporal information. Application of the disproportionality methods to LODs has not been
widely explored. The scale of the LOD data provides an interesting computational challenge. Larger health
claims databases contain information on more than 50 million patients and each patient has records for up
to 10 years. In this article we systematically explore the application of commonly used disproportionality
methods to simulated and real LOD data.
Keywords
data mining, disproportionality methods, spontaneous report databases, longitudinal observational
databases, OMOP, PRR, ROR, EBGM, IC

1 Introduction
Increasing scientiﬁc, regulatory and public scrutiny focuses on the obligation of the medical community,
pharmaceutical industry and health authorities to ensure that marketed drugs have acceptable beneﬁtrisk proﬁles. This is an intricate and ongoing process that begins with careful pre-approval studies but
continues after regulatory market authorisation when the drug is in widespread clinical use. In the latter
environment, surveillance schemes based on spontaneous reporting system (SRS) databases represent a
cornerstone for the early detection of drug hazards that are novel by virtue of their clinical nature,
severity and/or frequency. SRS databases collect voluntary reports of adverse events made directly to
1

Department of Statistics, Columbia University, New York, USA
Johnson & Johnson Pharmaceutical Research and Development
3
Pfizer, Inc., USA
2

Corresponding author:
Ivan Zorych, Department of Statistics, Columbia University, New York, USA
Email: iz2129@columbia.edu

40

Statistical Methods in Medical Research 22(1)

the regulator or to the manufacturer of the product. Such spontaneous report databases present a
number of well-documented limitations such as under-reporting, over-reporting and duplicate
reporting. Furthermore, SRS databases fail to provide a denominator – the number of individuals
that are actually consuming a drug – and generally have limited temporal information with regard to
duration of exposure and the time order of exposure and condition.1
Despite the limitations inherent in SRS-based pharmacovigilance, analytic methods for spontaneous
report databases have attracted considerable attention in the last decade, and several diﬀerent methods
have become well established, both in commercial software products and in the medical literature. A
number of methods have been applied to the analysis of spontaneous reports2–5 including some recent
work focused on Bayesian shrinkage regression6 but all of the more widely used methods compute
measures of ‘disproportionality’ for speciﬁc drug-condition pairs.7 That is, the methods quantify the
extent to which a given condition is ‘disproportionally’ reported with a given drug.
Newer data sources have emerged that overcome some of the SRS limitations but present
methodological and logistical challenges of their own. Longitudinal observational databases
(LODs) provide time-stamped patient-level medical information. Typical examples include medical
claims databases and electronic health record systems.The scale of some of these databases
presents interesting computational challenges – the larger claims databases contain upwards of 50
million lives with more than 1 billion of clinical observations (prescription dispensings, diagnoses,
procedures, laboratory tests) over up to 10 years per life. A nascent literature on signal detection in
LODs exists. Several papers have looked at vaccine safety in this context – see, for example, Lieu
et al.,8 McClure et al.,9 and Walker.10 Papers focusing on drug safety include Curtis et al.,11 Jin
et al.,12 Kulldorﬀ et al.,13 Li,14 Norén et al.15 and Schneeweiss et al.16
In this article we explore the application of disproportionality methods to the LOD context. The
motivation for our work derives from several quarters. First, disproportionality methods have become
familiar to drug safety scientists and, insofar as such methods can be applied to LODs, the learning
curve should be modest. Second, many of the standard disproportionality methods have the potential
to scale well to very large databases. Third, the simplicity of many of the disproportionality methods
leads to transparent outputs. Finally, issues related to multiplicity and shrinkage estimation for
disproportionality have attracted considerable attention and mature solutions are now available.

2 Prior work
There has been some previous work on the implementation of measures of disproportionality in the
context of LODs. Jin et al.12 looked at the incidence of an adverse event in a ﬁxed 6 month hazard
period subsequent to the prescription of a given drug in linked pharmaceutical, hospital and medical
service data from Australia. Norén et al.15 have chosen to adapt the Information Component (IC)
measure of disproportionality to account for the occurrence, or not, of disease prior to drug
prescription as done in a self-controlled case series analysis. Norén et al.15 refer to this measure
as an IC delta and also present a lower 95% conﬁdence limit of the IC delta. In subsequent work17
they showed results from for a speciﬁc drug-wide screen that an IC calculated from data solely after
drug exposure only highlighted quantitatively one known reaction in a top 10 listing, as opposed to
the seven that the IC delta achieved. All results from this research group were based on the analysis
of the UK IMS Disease Analyser data set.
Curtis et al.11 proposed how one of the measures of disproportionality, the Multi-item Gamma
Poisson Shrinker (MGPS) might be used to screen the Medicare claims database. They only looked at
a single data set and one speciﬁc established drug-AE combination that they showed they were able to
highlight this established issue.

Zorych et al.

41

Hocine et al.18 combine the self-controlled case series approach with a sequential probability ratio
test (SPRT) to allow for prospective repeated analysis of evolving collections of electronic patient
records. As for the SPRT, the authors focus on searching for predeﬁned types of pattern rather than
truly open-ended hypothesis generation.
A related approach to measures of disproportionality, is the use of a SPRT to screen healthcare
data sets. Davis et al.19 retrospectively examined 5 years of data from 4 HMO networks to compare
the rates of a small number of selected examples including intussusception after rotavirus
vaccination and showed that these new vaccine eﬀects could be highlighted early using the SPRT
on this data set. The SPRT approach has subsequently been used to look at drugs and vaccines
throughout the HMO Research Network.8,20,21

3 Disproportionality methods and spontaneous reports
Disproportionality analysis methods for drug safety surveillance represent the primary class of
analytic methods for analysing data from SRSs. SRSs receive reports that comprise of one or
more drugs, one or more adverse events (AEs), and possibly some basic demographic information
(in addition to narrative and text data). These reports are compiled into a computerised database,
which can be used to standardise the identiﬁcation of the co-occurrence of drugs and adverse events
within each report.Table 1 below shows a conceptual representation of a typical SRS entry.
Disproportionality analysis methods include the MGPS,22–24,37 proportional reporting ratios
(PRR),25 reporting odds ratios (ROR),26 and Bayesian conﬁdence propagation neural network
(BCPNN).27,28 The methods search SRS databases for ‘interesting’ associations and focus on lowdimensional projections of the data, speciﬁcally two-dimensional contingency tables. Table 2 shows
a typical table.
The basic task of a disproportionality method then is to rank order the tables in order of
‘interestingness’. Diﬀerent disproportionality methods focus on diﬀerent statistical measures of
association as their measure of ‘interestingness’. MGPS focuses on the ‘reporting ratio’ (RR). The
observed RR for the drug i – adverse event j combination (RRij) is the number of occurrences of the
combination (20 in the example above) divided by the expected number of occurrences. MGPS
computes the expected value under a model of independence. Speciﬁcally, in the example above,
overall, AE j occurs in 10% of the reports (120/1200). Thus, if drug i and adverse event j are
statistically independent, 10% of the reports containing drug i should include AE j, that is, 12
reports in this case. Thus the observed RR for this example is 20/12 or 12/3; this combination
occurred about 67% more often than expected.
Table 1. A conceptual representation of a typical entry in an spontaneous reporting system database
Age

Sex

Drug 1

Drug 2

...

Drug 15000

AE 1

AE 2

...

AE 16000

42

Male

No

Yes

...

No

Yes

No

...

Yes

Table 2. A fictitious two-dimensional projection of an spontaneous reporting system database

Drug i ¼ Yes
Drug i ¼ No
Total

AE j ¼ Yes

AE j ¼ No

Total

w00 ¼ 20
w10 ¼ 100
120

w01 ¼ 100
w11 ¼ 980
1080

120
1080
1200

42

Statistical Methods in Medical Research 22(1)

Natural (though not necessarily unbiased) estimates of various probabilities emerge from tables
like Table 2. For example, one might estimate the conditional probability of AE j given drug i by
w00/w00+w01 (i.e. 20/120 in the example above). That is, the observed fraction of drug i reports that
listed AE j. Table 3 lists the formulae for the various measures of association in common use, along
with their probabilistic interpretation. Here drug for example, denotes the reports that did not list
the target drug. PRR is the ‘Proportional Reporting Ratio’, ROR is the ‘Reporting Odds Ratio’,
and IC is the ‘Information Component’ used by BCPNN.27,28
All four of these measures make sense – in each case, a particular drug that is more likely to cause
a particular AE than some other drug will typically receive a higher score. Similarly, if an AE and a
drug are stochastically independent, all measures will return a null value. However, all four are
subject to sampling variability, that is, a diﬀerent set of AE reports from the same ‘population’ will
not give exactly the same value of the measure of association. This may be particularly the case with
large sparse databases. Due to the Law of Large Numbers, this statistical variability diminishes as
the sample size increases. In the SRS context, however, the count in the ‘w00’ cell is often small,
leading to substantial variability (and hence uncertainty about the true value of the measure of
association) despite the often large numbers of reports overall.
PRR and ROR do not address the variability issue whereas MGPS and BCPNN adopt a Bayesian
approach to address the issue. MGPS places a prior distribution on RRs that encapsulates a prior
belief that most RRs are close to the average value of all RR’s (i.e. close to 1) whereas the BCPNN
assumes a prior distribution centred around an RR of 1, based on empirical testing. Only in the face
of substantial evidence from the data does BCPNN or MGPS return an RR estimate that is
substantially larger than one. Thus, for example, an RR of 1,000 that derives from an observed
count of w00 ¼ 1 might result in a MGPS RR estimate (Empirical Bayesian Geometric Mean or
EBGM) of 1.5 (i.e. the crude RR is shrunk towards a value of 1) whereas an RR of 1000 that
derives from an observed count of w00 ¼ 100 might result in a EBGM RR estimate of close to
1000. For the speciﬁc Bayesian setup that MGPS uses, observed counts in excess of 10 result in
RR estimates that typically receive essentially no shrinkage, although in practice larger diﬀerentials
have been observed depending on the thresholds used.29–31 Similar properties have been observed
with the BCPNN.7,32 We note that small cell counts may be less frequent in LODs than SRS.
The EBGM and IC scores are means of the posterior distribution of the true RR. Other summaries
are possible. For example, DuMouchel mentions EB05.22 This is the 5th percentile of the posterior
distribution – meaning that there is a 95% probability that the ‘true’ RR exceeds the EB05. Since
EB05 is always smaller than EBGM this, in a sense, adds extra shrinkage and represents a more
conservative choice than EBGM.
We note some analysts use the standard chi-square statistic for 2  2 tables, especially in
combination with the PRR score. We include a ‘signed’ chi-square statistic in our analyses below.

Table 3. Common measures of association for 2  2 tables in spontaneous reporting system analyses
Measure of association

Formula

Probabilistic interpretation

RR (Reporting Ratio)
PRR (Proportional Reporting Ratio)

w00 ðw00 þw01 þw10 þw11 Þ
ðw00 þw10 Þðw00 þw01 Þ
w00 =ðw00 þw01 Þ
w10 =ðw10 þw11 Þ

ROR (Reporting Odds Ratio)

w00 =w10
w01 =w11

IC (Information Component)

w00 þw01 þw10 þw11 Þ
log2 w00ðw00ðþw
10 Þðw00 þw01 Þ

prðaejdrugÞ
prðaeÞ
prðaejdrugÞ
prðaejdrugÞ
prðaejdrugÞ=prðaejdrugÞ
prðaejdrugÞ=prðaejdrugÞ
prðaejdrugÞ
log2 prðaeÞ

Zorych et al.

43

4 Applying disproportionality analysis to longitudinal data
In the context of spontaneous report systems, some authors use the term ‘signal of disproportionate
reporting’ (SDR) when discussing associations highlighted by disproportionality methods.1,33
Hauben and Reich introduced the term to distinguish metric scores in SRS data from signals of
suspected causality that have undergone clinical review. As in reality, most SDRs that emerge from
spontaneous report databases represent noise because the reports are associated with treatment
indications (i.e. confounding by indication), co-prescribing patterns, co-morbid illnesses,
protopathic bias, channelling bias, or other reporting artefacts, or, the reported adverse events are
already labelled or are medically trivial. In this sense, SDRs represent generated hypotheses about
potential drug safety issues that warrant further investigation. Furthermore, spontaneous report
databases present a number of well-documented limitations such as under-reporting, overreporting, and duplicate-reporting, they fail to provide a denominator – how many individuals are
actually consuming drug, and generally have limited temporal information with regard to duration of
exposure and the time order of exposure and condition.1 The richer context of longitudinal data (such
as claims databases or electronic health records) aﬀords the possibility of more reﬁned analysis to
address some of these artifacts. Nonetheless, given the wide acceptance of disproportionality methods
in pharmacovigilance, application of these approaches to longitudinal data may prove useful.
The key step in the application of disproportionality methods to any data is the mapping of the
data into drug-condition 2  2 tables. With longitudinal data many choices present themselves. In
this article we consider three particular approaches, ‘distinct patients’, ‘SRS’, and ‘modiﬁed SRS’.
In what follows we will illustrate the approaches using the example of Figure 1. The ﬁgure shows
three patients. Patient 1 consumed drug A during two separate drug eras, or spans of persistent
exposure to a particular medical product. The patient experienced condition X three times during
these eras, twice during the ﬁrst era and once during the second. Patient 2 also had three drug eras
but with three separate drugs, A, B and C. Finally Patient 3 had two overlapping drug eras, one with
drug B and one with drug C. The patient experienced condition O while taking both B and C, and
conditions O and X after the drug eras.
Note we treat conditions as if they occur at distinct moments in time. In fact the data may contain
condition ‘eras’, or episode of care for a particular disease, and what we are utilising is the
timestamp of the beginning of the era. Drug eras, on the other hand, play an important role in
our approach. A drug era represents a continuous period of drug usage, which can be augmented
during analysis with an additional period post-exposure to capture outcomes that may still be drug
related. We refer to the optional post-exposure period as a surveillance window.
We now consider three diﬀerent approaches to constructing the 2  2 table for drug A and
condition X. Appendix B provide a formal mathematical description.

Figure 1. A longitudinal dataset with three patients, three distinct drugs (A, B and C) and two distinct conditions
(X and O).

44

4.1

Statistical Methods in Medical Research 22(1)

Distinct patients

In the ‘distinct patients’ approach to table construction, w00+w01+w10+w11 (denoted w++) equals
the total number of patients in the database. w00 is the number of patients that had a drug A era and
experienced condition X during a drug A era. w01 is the number of patients that had a drug A era
and did not experience condition X during a drug A era. w10 is the number of patients that did not
have a drug A era but experienced condition X. w11 is the number of patients that did not have a
drug A era and never experienced condition X. Thus, for the example of Figure 1, w00 ¼ 1 (patient 1),
w01 ¼ 1 (patient 2), w10 ¼ 1 (patient 3), and w11 ¼ 0. Note that w++ ¼ 3.

4.2

Spontaneous reporting system

The second approach attempts to mimic what SRS reports the longitudinal data would generate, in
that the observed co-occurrence of a drug and outcome is treated as if it were reported as a
spontaneous case. w00 is the number of distinct X conditions the occur during drug A eras. w01 is
the number of distinct non-X conditions that occur during drug A eras. w10 is the number of distinct
X conditions that occur during non-A drug eras. w11 is the number of distinct non-X conditions that
occur during non-A drug eras. Thus, for the example of Figure 1, w00 ¼ 3 (A+X1, A+X2, A+X3),
w01 ¼ 0, w10 ¼ 1 (B+X5) and w11 ¼ 2 (B+O1,C+O1).

4.3

Modified-spontaneous reporting system

A third approach augments the SRS-like reports with additional denominator-based information
about exposures without outcomes and outcomes that occurred without prior exposure. This
approach attempts to patch obvious weaknesses of the SRS approach by taking advantage of
the other information available in the LODs. Speciﬁcally, whereas the SRS systems do not contain
the total number of drug exposures, only those exposures that were co-reported with an adverse
event, LODs oﬀer the potential to measure the number of event-free exposures. Similarly, the
background rate of events is not well captured in SRS, since only drug-related events are recorded,
whereas LOD can provide information about conditions that occur independently from drug
exposures. The modiﬁed SRS approach counts ‘non-event’ drug eras and ‘non-drug’ conditions
that can be combined with all drug-related events prior to calculating the disproportionality
measures. In this approach, as with SRS, w00 is the number of distinct X conditions that occur
during drug A eras. w01 however, is the number of distinct non-X conditions that occur during
drug A eras plus the number of A eras in which no events occur. w10 is the number of distinct X
conditions that occur outside drug A eras. w11 is the number of distinct non-X conditions that
occur during non-A drug eras plus the number of non-A drug eras with no conditions plus the
number of non-X conditions with no drug era. Thus, for the example of Figure 1, w00 ¼ 3 (A+X1,
A+X2, A+X3), w01 ¼ 1 (patient 2’s A era), w10 ¼ 3 (X4, B+X5, X6) and w11 ¼ 4 (patient 2’s C era,
B+O1, C+O1, O2).
Our application of disproportionality methods to longitudinal data also makes a distinction
between incident and prevalent conditions. The incident case only considers the ﬁrst occurrence of
each event, whereas the prevalent case (considered in the above example) considers all occurrences.
Thus, for the example above, the incident analysis would proceed as above but only consider the ﬁrst
event of each type. Figure 2 illustrates the modiﬁed dataset used in an incident analysis. Note that our
use of the term ‘incident’ does not necessarily coincide with standard use of this term in
epidemiological practice. In particular, we do not require an event-free ‘clean’ period prior to ﬁrst
condition occurrence.

Zorych et al.

45

Figure 2. A longitudinal dataset with three patients, three distinct drugs (A, B and C) and two distinct conditions
(X and O). Incident conditions only.

Three mapping approaches, distinct patients, SRS and modiﬁed SRS, together with two condition
types, prevalent and incident, produce six mapping scenarios: distinct patients-prevalent, distinct
patients-incident, SRS-prevalent, SRS-incident, modiﬁed SRS-prevalent and modiﬁed SRS-incident.
In this study we use nine disproportionality measures: PRR, PRR05 (left bound of the 90%
conﬁdence interval for PRR), ROR, ROR05 (left bound of the 90% conﬁdence interval for ROR),
IC, IC05 (lower credibility limit for 90% credibility interval for IC), EBGM, EB05 and signed chisquare. See Appendix A for additional details.

5 Data and evaluation procedure
5.1 Real data
In the numerical experiments reported below, we use de-identiﬁed Thomson Reuters MarketScan
Lab database (MSLR). MSLR contains 1.5 million persons representing a largely privatelyinsured population, with administrative claims from inpatient, outpatient and pharmacy services
supplemented by laboratory results. We also successfully executed all mentioned above LOD mapping
approaches and calculated disproportionality metrics on several other de-identiﬁed Thomson Reuters
databases: Medicaid Multi-State database (MDCD), Medicare Supplemental and Coordination of
Beneﬁts database (MDCR), and Commercial Claims and Encounters database (CCAE). These three
databases contain medical records of 5 million, 11 million and 59 million persons, respectively.

5.2

Simulated data

For performance evaluation purposes, we used a simulated database (OSIM). OSIM is modelled
after real observational databases. It contains information on 10 million simulated persons, 5000
simulated drugs and 4000 simulated conditions. Database date range is 10 years. Because of
simulated nature of the data, the list of true drug-condition associations is available, enabling
quantitative comparison of the diﬀerent measures of disproportionality.

5.3

Mean average precision

To compare the performance of diﬀerent disproportionality methods, we use ‘mean average precision’
(MAP), a scoring method widely used in text retrieval. Higher values of a MAP score indicate better
performance. Let ydc ¼
P1 if the dth drug causes the cth condition and 0 otherwise, d ¼ 1 , . . . , D,
c ¼ 1 . . ., C. Let M ¼ d,c ydc denote the number of causal combinations and N¼DC the total
number of combinations. Note it is generally the case that M 55 N. Let zdc denote the score
(EBGM, IC, PRR etc.) for the dth drug and the cth condition. For a given set of predicted values
z~ ¼ ðz11 , . . . , zdc Þ, we deﬁne ‘precision-at-K’ denoted PðKÞ ð~zÞas the fraction of causal combinations

46

Statistical Methods in Medical Research 22(1)

amongst the K largest predicted values in z~.34 Speciﬁcally, let zð1Þ 4    4 zðNÞ denote the ordered values
of z~. Then:
K
1X
yðiÞ
PðKÞ ð~zÞ ¼
K i¼1
whereyðiÞ is the causal status of the combination corresponding tozðiÞ . The mean average precision or
MAP score, S, is then:
1 X ðKÞ
S¼
P ð~
zÞ
M K:y ¼1
ðKÞ

If there are ties in z~, the results are ordered such that negative drug-condition combinations, that is
combinations such that ydc ¼ 0, go ﬁrst. The precision of tied positive combinations, that is
combinations such that ydc ¼ 1, is calculated as if they were all encountered at the same time,
that is if zðKÞ ¼ zðKþ1Þ , then PðKÞ ð~zÞ ¼ PðKþ1Þ ð~
zÞ.
Table 4 contains hypothetical drug-condition pairs and their scores. Suppose that there are 3
drugs, D1, D2 and D3, and 3 conditions, C1, C2 and C3. But only 5 pairs, D1-C1, D1-C2, D2-C1,
D2-C2 and D3-tC3 are causal combinations and the remaining pairs are not. Table 5 illustrates the
scoring process.
Table 4. Sample data: 3 drugs, 3 conditions; yi ¼ 1 if drug-condition combination is positive, yi ¼ 0 otherwise
Drug

Condition

Score (z)

Truth (y)

D1

C1
C2
C3
C1
C2
C3
C1
C2
C3

5
0
9
8
5
0
0
0
5

1
1
0
1
1
0
0
0
1

D2

D3

Table 5. Illustration of the mean average precision methodology
Sorted values
Drug
Condition
D1
C3
D2
C1
D3
C3
D1
C1
D2
C2
D2
C3
D3
C1
D3
C2
D1
C1
MAP ¼ (1 + 1 + 0.75 + 0.8 + 0.55) / 5 ¼ 0.82

z
9
8
5
5
5
0
0
0
0

y
1
1
0
1
1
0
0
0
1

P(K)
1/1 ¼ 1
2/2 ¼ 1
3/4 ¼ 0.75
4/5 ¼ 0.8

5/9 ¼ 0.55

Zorych et al.

47

In some cases, not every possible drug-condition combination may be assigned a score. Pairs
without a valid score are treated as if they were given the lowest possible score value. In Table 5
these pairs would be placed after all scores that were actually observed.

6 Results
6.1 Application to simulated data
Disproportionality analysis methods were computationally eﬃcient, executing against the simulated
dataset with 10 million persons for 4000 drugs and 5000 conditions and 4.9  108 drug-condition cooccurrences. All analyses were able to complete in less than 24 h, running in a single 64-bit computer
with 2.67 GHz I-7 CPU and 12 GB of RAM.
Figure 3 shows scatterplots of the various disproportionality measures (on the logarithmic scale)
for a random sample of 1000 drug-condition pairs for the SRS-prevalent scenario.
PRR and ROR scores are very similar, as it is almost always the case with the LOD data that w00
is much smaller than w01, and the same is true for w01 and w11. Due to the same rationale, PRR05
and ROR05 scores are extremely close as well. IC and EBGM, both being shrinkage estimators,
show quite similar behaviour, as do IC05 and EB05. Scatterplots of PRR versus EBGM (PRR vs.
IC, PRR vs. IC05, ROR vs. EBGM, PRR vs. EB05 etc.) shows greater variability because PRR
gives similar to EBGM results when cell counts, w00, are large but PRR is less stable for small
counts.35 Signed chi-square scores are qualitatively diﬀerent from other measures of
disproportionality. We observed similar relationships in the other ﬁve analysis scenarios: distinct
patients-incident, distinct patients-prevalent, SRS-incident, modiﬁed SRS-prevalent and modiﬁed
SRS-incident.
Figure 4 illustrates the EBGM scores across the six diﬀerent table construction scenarios. It is
interesting to note that for the same counting approach, distinct patients, SRS or modiﬁed SRS,
scores are often similar across diﬀerent event types, prevalent or incident. Distinct patient counting
approach shows similar scores for both prevalent and incident event types. SRS counting approach
shows the same. It is also worth noting that SRS-prevalent scores are similar to both SRS-incident
and modiﬁed SRS-incident scores.

6.2

Performance on simulated data

Figure 5 presents MAP scores for all six approaches to table construction (distinct patients,
SRS, and modiﬁed SRS for both prevalent events and incident events) and nine diﬀerent
scoring approaches (PRR, ROR, IC, EBGM, signed chi-square, PRR05, ROR05, IC05 and
EB05).
Figure 5 shows that:
– both the SRS and modiﬁed SRS counting approaches provide similar performance for both
incident and prevalent cases;
– the distinct patients approach to table construction provides inferior performance to the other
two counting approaches, SRS and modiﬁed SRS;
– the Bayesian approaches to scoring, IC and EBGM, provide the highest levels of performance,
with signed chi-square, IC05 and EB05 not far behind;
– for all three counting approaches, distinct patients, SRS, and modiﬁed SRS, ROR and PRR
provide the lowest MAP scores.

48

Statistical Methods in Medical Research 22(1)
2

-1

2 4

-4

0

4

-4

0

4

2

-2

2

-2

PRR

1 3

-2

ROR

2 4

-2

IC

400

-1

EBGM

4

-400 0

sgnChiSq

4

-4

0

PRR05

0

4

-4

0

ROR05

1

4

-4

IC05

-2

EB05

-2

2

-2

1 3

-400 0

400

-4

0

4

-2

1

4

Figure 3. Prevalent events – SRS (simulated data). Scatterplots (on the logarithmic scale) of nine measures of
disproportionality for the SRS-prevalent scenario on the simulated data.

6.3

Application to the real data

Whereas spontaneous reporting databases contain several million records, LODs can contain more
than one order of magnitude in data size, so computational feasibility remains central to eﬃcient
analysis. In this study, all disproportionality analysis conﬁgurations were executed against all drugs
and all conditions across the ﬁve databases. In the largest database, CCAE, there were over 4.4
billion drug-condition co-occurrences identiﬁed over 1451 drugs and 11 844 conditions. All analyses
were able to complete in less than 24 h.

Zorych et al.

49
1

3

-5

-3

-1

1

-2

0

2

4

-4 -2 0

2

-1

3

Prev-DPat

2

4

-1

1

Prev-SRS

-1

1

-2

0

Prev-mSRS

3

5

-5

-3

Inc-DPat

2

4

-1

1

Inc-SRS

-2

0

Inc-mSRS

-4 -2

0

2

-2

0

2

4

-1

1

3

5

Figure 4. EBGM scores across six scenarios (simulated data). Scatterplots of EBGM scores across six scenarios:
Distinct patients-prevalent, SRS-prevalent, modified SRS-prevalent, distinct patient-incident, SRS-incident, modified
SRS-incident.

Figure 6 shows various scores (on the logarithmic scale) for a random sample of 1000 drugcondition pairs for the SRS-prevalent scenario on the MSLR data. Key ﬁndings are similar to what
we observed on the simulated data:
. PRR and ROR are very close to each other, as are PRR05 and ROR05;
. Bayesian shrinkage approaches, IC and EBGM, IC05 and EB05, show agreement on most of the
drug/condition pairs;

Statistical Methods in Medical Research 22(1)

P re va le nt

Inc i d e nt

0.10

0.15

PRR
ROR
IC
EBGM
sgnChiSq
PRR05
ROR05
IC05
EB05

0.00

0.05

MAP score

0.20

0.25

50

DPat

SRS

mSRS

DPat

SRS

mSRS

Figure 5. MAP Scores for DP Methods (simulated data). Scores for all six approaches to table construction and nine
different scoring approaches.

. scatterplots of PRR versus EBGM (and other similar metrics) have several branches because
amount of shrinkage depends on observed cell count;
. signed chi-square scores behave diﬀerently from other measures of disproportionality.
Similar ﬁndings apply to the SRS-incident, modiﬁed SRS-prevalent, modiﬁed SRS-incident and
distinct patient prevalent and incident scenarios.
Figure 7 shows EBGM scores on MSLR data across all six table construction scenarios. As on the
simulated data, EBGM scores on MSLR show good agreement for both event types, prevalent and
incident. Distinct patient prevalent and incident scores are quite similar, as well as SRS-prevalent and
SRS-incident, modiﬁed SRS-prevalent and modiﬁed SRS-incident. Within each event type, prevalent
and incident, SRS and modiﬁed SRS scores are close.

7 Conclusions
There is a signiﬁcant interest in utilisation of observational health care data in drug safety research.
Statistical methods based on diﬀerent measures of disproportionality were among the ﬁrst employed
in pharmacovigilance.36 Therefore it seems natural to extend these methods to the analysis of
longitudinal data. This article is the ﬁrst systematic attempt of such an extension.
We propose three counting approaches, distinct patients, SRS, and modiﬁed SRS, which in
conjunction with two event types, prevalent or incident, lead to six diﬀerent mappings of LOD into
the form appropriate for disproportionality analysis.

Zorych et al.

51
2 6

-4 0

4

-6

0

6

-6 -2

2
2 6

-4

2 6

-4

PRR

2

-4

ROR

4

-2

IC

-400 200

-4 0

EBGM

6

sgnChiSq

6

-6

0

PRR05

2

-6

0

ROR05

EB05

-4

2 6

-2

2

-400 200

-6

0

6

-4 0 4

-6 -2

IC05

-4 0 4

Figure 6. Prevalent events – SRS (MSLR). Scatterplots (on the logarithmic scale) of nine measures of
disproportionality for the SRS-prevalent scenario on MSLR.

In the numerical experiment, we considered nine measures of disproportionality. Among those
nine, shrinkage approaches, IC and EBGM, showed the best performance on the simulated data
with respect to MAP, closely followed by the derivative shrinkage measures, EB05 and IC05 and
signed chi-square test. No metric performed perfectly suggesting that further analysis of outputs of
any dispropiortionality metric would be needed to prevent false positive and false negative results.
Qualitative comparison of the results from the simulated dataset and MSLR data suggests that the
same set of disproportionality measures and similar mapping approaches, SRS and modiﬁed SRS,
may achieve the best performance on real data. Further research will help to test these hypotheses.

52

Statistical Methods in Medical Research 22(1)
0

4

-4

0

4

-2

2

0

4

-4

4

-4

Prev-DPat

2

6

-4

0

Prev-SRS

0

4

-2

Prev-mSRS

2

6

-4

Inc-DPat

2

-2

Inc-SRS

-2

Inc-mSRS

-4

0

4

-2

2

6

-2

2

6

Figure 7. EBGM scores across six scenarios (MSLR data). Scatterplots of EBGM scores across six scenarios: distinct
patients-prevalent, SRS-prevalent, modified SRS-prevalent, distinct patient-incident, SRS-incident, modified SRSincident.

While spontaneous adverse drug reaction databases may contain up to several million reports,
disproportionality analysis of observational health databases involves much larger amount of data
because each person may contribute numerous reports over time. Nevertheless we are able to
complete all calculations for disproportionality analysis even on a database that contains
information on almost 60 million people. The feasibility of such large scale screening of LOD is
promising. This opens new possibilities in pharmacovigilance research and, eventually, will
contribute to improved drug safety. The results presented here will also serve as a benchmark for

Zorych et al.

53

comparison when in the future other statistical methods are applied to the same data sets. Software
for all of the methods described in this article is freely available at http://omop.fnih.org.
References
1. Hauben M, Madigan D, Gerrits CM, Walsh L and Van
Puijenbroek EP. The role of data mining in
pharmacovigilance. Expert Opin Drug Saf 2005; 5:
929–948.
2. Praus M, Schindel F, Fescharek R and Schwarz S. Alert
systems for post-marketing surveillance of adverse drug
reactions. Stat Med 1993; 12: 2382–2393.
3. vanPuijenbroek EP, Egberts AC, Heerdink ER and
Leufkens HG. Detecting drug-drug interactions using a
database for spontaneous adverse drug reactions: an
example with diuretics and non-steroidal anti-inflammatory
drugs. Eur J Clin Pharmacol 2000; 56: 733–738.
4. Orre R, Bate A, Norén GN, Swahn E, Arnborg S and
Edwards IR. A Bayesian recurrent neural network for
unsupervised pattern recognition in large incomplete data
sets. Int J Neural Syst 2005; 15: 207–222.
5. Mammadov MA, Rubinov AM and Yearwood J. The
study of drug–reaction relationships using global
optimization techniques. Optim Meth Software 2007; 22:
99–126.
6. Caster O, Norén GN, Madigan D and Bate A. Large-scale
regression-based pattern discovery: the example of
screening the WHO global drug safety database. Stat Anal
Data Min 2010; 3(4): 197–208.
7. Bate A and Evans SJ. Quantitative signal detection using
spontaneous ADR reporting. Pharmacoepidemiol Drug Saf
2009; 18(6): 427–436.
8. Lieu TA, Kulldorff M, Davis RL, et al.. Real-time vaccine
safety surveillance for the early detection of adverse events.
Med Care 2007; 45: S89–S95.
9. McClure DL, Glanz JM, Xu S, Hambidge SJ, Mullooly JP
and Baggs J. Comparison of epidemiologic methods for
active surveillance of vaccine safety. Vaccine 2008; 26:
3341–3345.
10. Walker AM. Signal detection for vaccine side effects that
have not been specified in advance. Pharmacoepidemiol
Drug Saf 2010; 19(3): 311–317.
11. Curtis JR, Cheng H, Delzell E, et al.. Adaptation of
Bayesian data mining algorithms to longitudinal claims
data. Med Care 2008; 46: 969–975.
12. Jin H, Chen J, He H, Williams GJ, Kelman C and O’Keefe
CM. Mining unexpected temporal associations:
Applications in detecting adverse drug reactions. IEEE
Trans Info Tech Biomed 2008; 12: 488–500.
13. Kulldorff M, Davis RL, Kolczak M, Lewis E, Lieu T and
Platt R. A maximized sequential probability ratio test for
drug and vaccine safety surveillance. Sequen Anal 2008; 30:
58–78.
14. Li L. A conditional sequential sampling procedure for
drug safety surveillance. Stat Med 2009; 28(25):
3124–3138.
15. Norén GN, Bate A, Hopstadius J, Star K and Edwards IR.
Temporal pattern discovery for trends and transient
effects: its application to patient records. Proceedings of the
14th ACM SIGKDD International Conference on
Knowledge Discovery and Data Mining - KDD ’08.
Las Vegas, Nevada, USA; 2008; pp. 963–971.
16. Schneeweiss S, Rassen JA, Glynn RJ, Avorn J, Mogun H
and Brookhart MA. High-dimensional propensity scoring
adjustment in studies of treatment effects using health care
claims data. Epidemiology 2009; 20: 512–522.
17. Norén GN, Hopstadius J, Bate A, Star K and Edwards IR.
Temporal pattern discovery in longitudinal electronic

18.

19.

20.

21.

22.

23.

24.

25.

26.

27.

28.

29.

30.

31.

32.

33.

patient records. Data Min Knowl Discov 2010; 20(3):
361–387.
Hocine MN, Musonda P, Andrews NJ and Farrington C.
Sequential case series analysis for pharmacovigilance. J R
Stat Soc: Series A (Stat Soc) 2009; 172(1): 213–236.
Davis RL, Kolczak M, Lewis E, et al.. Active surveillance
of vaccine safety data for early signal detection.
Epidemiology 2005; 16: 336–341.
Brown JS, Kulldorff M, Chan KA, et al.. Early detection
of adverse drug events within population-based health
networks: application of sequential testing methods.
Pharmacoepidemiol Drug Saf 2007; 12: 1275–1284.
Brown JS, Kulldorff M, Petronis KR, et al.. Early adverse
drug event signal detection within population-based health
networks using sequential methods: key methodologic
considerations. Pharmacoepidemiol Drug Saf 2009; 18(3):
226–234.
DuMouchel W. Bayesian data mining in large frequency
tables, with an application to the FDA spontaneous
reporting system. Am Stat 1999; 53(3): 170–190.
DuMouchel W and Pregibon D. Empirical Bayes screening
for multi-item associations. Proceedings of the Seventh
ACM SIGKDD. California: San Francisco, 2001, pp.
67–76.
Fram D, Almenoff J and DuMouchel W. Empirical
Bayesian data mining for discovering patterns in postmarketing drug safety. Proceedings of the 9th ACM
SIGKDD International Conference on Knowledge
Discovery and Data Mining – KDD’03, Washington, DC,
USA, 2003; pp. 359–368.
Evans SJ, Waller PC and Davis S. Use of proportional
reporting ratios (PRRs) for signal generation from
spontaneous adverse drug reaction reports.
Pharmacoepidemiol Drug Saf 2001; 10(6): 483–486.
Rothman KJ, Lanes S and Sacks ST. The reporting odds
ratio and its advantages over the proportional reporting
ratio. Pharmacoepidemiol Drug Saf 2004; 13(8): 519–523.
Bate A, Lindquist M, Edwards IR, et al.. A Bayesian
neural network method for adverse drug reaction signal
generation. Eur J Clin Pharmacol 1998; 54(4): 315–321.
Norén NG, Bate A, Orre R and Edwards IR. Extending
the methods used to screen the WHO drug safety database
towards analysis of complex associations and improved
accuracy for rare events. Stat Med 2006; 25: 3740–3757.
Hauben M and Zhou X. A brief primer on automated
signal detection quantitative methods in
pharmacovigilance: focus on signal detection. Ann
Pharmacother 2003; 37(7–8): 1117–1123.
Hauben M, Reich L and Zhou X. Safety related druglabelling changes: findings from two data mining
algorithms. Drug Saf 2004; 27(10): 735–744.
Hauben M and Zhou X. Trimethoprim-induced
hyperkalaemia - lessons in data mining. Br J Clin
Pharmacol 2004; 58(3): 338–339.
van Puijenbroek EP, Bate A, Leufkens HGM, Lindquist
M, Orre R and Egberts ACG. A comparison of measures
of disproportionality for signal detection in spontaneous
reporting systems for adverse drug reactions.
Pharmacoepidemiol Drug Saf 2002; 11: 3–10.
Hauben M and Reich L. Potential utility of data-mining
algorithms for early detection of potentially fatal/disabling
adverse drug reactions: a retrospective evaluation. J Clin
Pharmacol 2005; 45(4): 378–384.

54

Statistical Methods in Medical Research 22(1)
36. Finney DJ. Statistical logic in the monitoring of adverse
reactions to therapeutic drugs. Meth Inform Med 1971; 10:
237–242.
37. Szarfman A, Machado SG and O’Neill RT. Use of
screening algorithms and computer systems to efficiently
signal higher-than-expected combinations of drugs and
events in the US FDA’s spontaneous reports database.
Drug Saf 2002; 25(6): 381–392.

34. Madigan D, Vardi Y and Weissman I.
Extreme value theory applied to document
retrieval from large collections. Inform Retriev 2006; 9:
273–294.
35. Madigan D. Discussion of "Bayesian data mining in large
frequency tables, with an application to the FDA
spontaneous reporting system". Am Stat 1999; 53(3):
198–200.

Appendix A: Formulae for measures of disproportionality
Let us assume that for each stratum i we calculated two-dimesional summary that is shown in
Table 6. Let Ni be the sum of all cell counts, Ni ¼ Wi00 þ Wi01 þ Wi10 þ Wi11 .
Using these counts we can deﬁne stratiﬁed measures of disproportionality.
PRR, proportional reporting ratio:
PRR ¼

i Wi00  ðWi10 þ Wi11 Þ=Ni
:
i Wi10  ðWi00 þ Wi01 Þ=Ni

PRR05, left bound of the 90% conﬁdence interval for PRR:


i ððWi00 þ Wi01 ÞðWi10 þ Wi11 ÞðWi00 þ Wi10 Þ  Wi00  Wi10  Ni Þ=N2i
PRR05 ¼ PRR  exp 1:645 
i Wi00 ðWi10 þ Wi11 Þ=Ni i Wi10 ðWi00 þ Wi10 Þ=Ni

1=2 !
:

ROR, reporting odds ratio:
ROR ¼

i Wi00 Wi11 =Ni
:
i Wi10 Wi01 =Ni

ROR05, left bound of the 90% conﬁdence interval for ROR:
ROR05 ¼ ROR  expð1:645   Þ,
2 ¼

i ðWi00 þ Wi11 ÞWi00 Wi11 =N2i
i ðWi10 þ Wi11 ÞWi01 Wi10 þ ðWi01 þ Wi10 ÞWi00 Wi11 =N2i
þ
2 i Wi00 Wi11 =Ni i Wi01 Wi10 =Ni
2ði Wi00 Wi11 =Ni Þ2
i ðWi01 þ Wi10 ÞWi01 Wi10 =N2i
þ
:
2ði Wi01 Wi10 =Ni Þ2

IC, Information component:
IC ¼ log2

i Wi00 þ 1=2
i

ðWi00 þWi01 ÞðWi00 þWi10 Þ
Ni

!
þ 1=2

:

Table 6. Counts for the ith stratum

Drug Yes
Drug No

AE Yes

AE No

Wi00
Wi10

Wi01
Wi11

Zorych et al.

55

IC05, lower credibility limit for 90% credibility interval for IC:IC05 ¼ log2 ðzÞ, z is the solution to
Rz
nþ1=2
nþ1=21 ðnþ1=2Þ
i00 þWi10 Þ
equation 0 ðeþ1=2Þ
e
d ¼ 0:05, where e ¼ ðWi00 þWi01NÞðW
and n ¼ i Wi00
ðnþ1=2Þ 
i
For more details regarding IC and IC05 see Norén et al.15 and Bate et al.27
Signed chi-square:


sgnChiSquare ¼ sign  Wi00  ðWi00 þ Wi01 ÞðWi00 þ Wi10 Þ=Ni
i

i

ði Wi00  i ðWi00 þ Wi01 ÞðWi00 þ Wi10 Þ=Ni Þ2
:
i ðWi00 þ Wi01 ÞðWi10 þ Wi11 ÞðWi00 þ Wi10 ÞðWi01 þ Wi11 Þ=ðN2i ðNi  1ÞÞ


Details regarding EBGM, geometric mean of the empirical Bayes estimate of the posterior
distribution of the reporting ratio, and EB05, its 5th percentile, can be found in references
DuMouchel22 and DuMouchel and Pregibon.23

Appendix B: Mapping approaches for longitudinal data
This appendix provides a formal mathematical deﬁnition of the alternative methods of constructing
2  2 tables from longitudinal data for disproportionality analysis.

Notation
Let yict ¼ 1 if patient i has condition c at time t, andyict ¼ 0 otherwise, i ¼ 1 , . . . , I, c ¼ 1, . . . C and
t ¼ 1 , . . . , T. Let xidt ¼ 1 if patient i ‘takes’ drug d at time t, andxidt ¼ 0 otherwise, i ¼ 1 , . . . , I,
d ¼ 1 ,. . . D and t ¼ 1 , . . . , T. This may include the user-deﬁned oﬀ-drug ‘surveillance’ window. Let
yict ¼ 1 if yict ¼ 1 and yict ¼ 0 for all s 5 t, 0 otherwise:
Let zit ¼ 1 if patient i has coverage at time t, 0 otherwise.
Let Did be the set of all ordered pairs (r,s), r,s 2{1 , . . . , T}, where xidr ¼ 1 and (r ¼ 1 or
xid ðr1Þ ¼ 0), xids ¼ 1 and (s ¼ T or xid ðsþ1Þ ¼ 0), and yict ¼ 0 for all c and all t 2[r , . . . , s], and
zit ¼ 1 for all t 2[r , . . . , s]. This deﬁnes condition-free periods of continuous drug exposure.
Deﬁne I(x) ¼ 1 if x > 0, 0 otherwise.
Prevalent conditions, distinct patients
!
X X
w00 ¼
I
xidt yict
i

w01 ¼

X
i

w10 ¼

X
i

w11 ¼

X
i

t

(
I
(

X

!

X

zit xidt  I

t

1I

X

!

(
1I

X
t

!!
zit xidt

xidt yict

t

zit xidt  I

t

!)

X

!)
zit yict

t

 1I

X
t

!!)
zit yict

56

Statistical Methods in Medical Research 22(1)
Prevalent conditions, SRS
w00 ¼
w01 ¼
w10 ¼
w11 ¼

XX

xidt yict

t

t

t

t

c0 6¼c

t

t

d0 6¼d

t

t

d0 6¼d c0 6¼c

XXX
XXX

xidt yic0 t
xid0 t yict

XXXX

xid0 t yic0 t

Prevalent conditions, modiﬁed-SRS
XX
xidt yict
w00 ¼
i

w01 ¼

i

w10 ¼

t

)
xidt yic0 t þ jDid j

c0 6¼c

( (
X X X
i

w11 ¼

t

(
X XX

t

xid0 t yict þ yict zit 1  I

d0 6¼d

(
X XXX
i

t

X

d0 6¼d c0 6¼c

!!))
xidt

d

xid0 t yic0 t þ

X
d0 6¼d

jDid0 j þ

XX
t

zit yict 1  I

c0 6¼c

For incident conditions replace yict in the above deﬁnitions by yict .

X
d

!!)
xidt

